<!doctype html>
<html>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Constitutional Bias Dashboard — ETHRAEON</title>
<link rel="stylesheet" href="/assets/brand.css">
<body>
  <div class="container">
    <div class="hero">
      <div class="logo"></div>
      <div>
        <h1>Constitutional Bias Dashboard</h1>
        <div class="small">Monitor outputs vs. policies; spot failures; export audits.</div>
      </div>
    </div>

    <div class="card">
      <div class="badge">SIMULATED</div>
      <h2>What this tells you</h2>
      <p class="small" style="margin:6px 0">
        Each row is a policy check with PASS/FAIL and a short rationale. Use “Copy JSON” for tickets or
        “Export CSV” for stakeholder review. “If FAIL…” gives you a next step.
      </p>

      <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 4px">
        <button id="copyJsonBtn">Copy JSON</button>
        <button id="exportCsvBtn">Export CSV</button>
        <a id="viewRawJson" class="small" href="#" style="align-self:center">View raw JSON</a>
      </div>

      <div id="tableWrap" style="margin-top:10px;overflow:auto">
        <!-- table renders here -->
      </div>

      <div class="card" style="margin-top:12px">
        <strong>If FAIL…</strong>
        <ul class="small" style="margin:6px 0">
          <li><b>Identify</b> which prompt/output violated policy.</li>
          <li><b>Mitigate</b> (prompt rule, guardrail, or model filter).</li>
          <li><b>Re-test</b> and attach this dashboard’s export to the audit ticket.</li>
        </ul>
      </div>

      <p class="small" style="margin-top:10px">Status: Interactive demo with simulated data.</p>
    </div>
  </div>

  <script src="/assets/demo.js"></script>
  <script>
    let data = { tests: [] };

    function toCsv(rows) {
      const headers = ['Status','Policy','Details'];
      const lines = [headers.join(',')];
      rows.forEach(r=>{
        const status = r.pass ? 'PASS' : 'FAIL';
        // basic CSV escaping for commas/quotes
        const esc = v => `"${String(v).replace(/"/g,'""')}"`;
        lines.push([status, esc(r.policy), esc(r.details)].join(','));
      });
      return lines.join('\n');
    }

    function renderTable(d){
      const rows = d.tests || [];
      const html = `
        <table class="small" style="width:100%;border-collapse:collapse">
          <thead>
            <tr>
              <th style="text-align:left;border-bottom:1px solid #2a2e37;padding:6px 4px">Status</th>
              <th style="text-align:left;border-bottom:1px solid #2a2e37;padding:6px 4px">Policy</th>
              <th style="text-align:left;border-bottom:1px solid #2a2e37;padding:6px 4px">Details</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r=>`
              <tr>
                <td style="padding:6px 4px">
                  <span class="badge" style="background:${r.pass ? '#14351f' : '#3a1c1c'};border-color:${r.pass ? '#1f6f3c' : '#6f2a2a'}">
                    ${r.pass ? 'PASS' : 'FAIL'}
                  </span>
                </td>
                <td style="padding:6px 4px">${r.policy}</td>
                <td style="padding:6px 4px;opacity:.9">${r.details}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      document.getElementById('tableWrap').innerHTML = html;
    }

    // Load the simulated checks and wire buttons
    loadJSON('/data/bias.json').then(d=>{
      data = d;
      renderTable(d);

      document.getElementById('copyJsonBtn').onclick = async ()=>{
        try {
          await navigator.clipboard.writeText(JSON.stringify(data, null, 2));
          alert('Audit JSON copied to clipboard.');
        } catch {
          alert('Copy failed. (Your browser may block clipboard access.)');
        }
      };

      document.getElementById('exportCsvBtn').onclick = ()=>{
        const csv = toCsv(data.tests || []);
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url  = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'bias_audit.csv';
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      };

      document.getElementById('viewRawJson').onclick = (e)=>{
        e.preventDefault();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url  = URL.createObjectURL(blob);
        window.open(url, '_blank');
        setTimeout(()=>URL.revokeObjectURL(url), 10000);
      };
    });
  </script>
</body>
</html>
