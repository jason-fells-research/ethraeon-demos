<!doctype html><html lang="en">
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Constitutional Bias Dashboard — Demo</title>
<link rel="stylesheet" href="../assets/brand.css">
<body>
<div class="wrap">
  <h1>Constitutional Bias Dashboard <span class="badge">Demo</span></h1>

  <div class="card">
    <p class="small">Self-contained demo data. Buttons work without any backend.</p>
    <div style="margin:8px 0">
      <button id="btnSim">Simulate new run</button>
      <button id="btnCopyJSON">Copy JSON</button>
      <button id="btnCopyCSV">Copy CSV</button>
      <button id="btnViewJSON">View raw</button>
    </div>
    <div id="summary" class="small" style="margin-top:6px"></div>

    <table class="small" style="width:100%;margin-top:10px">
      <thead><tr><th>Status</th><th>Policy</th><th>Details</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="small" style="margin-top:10px">
      <b>Policy references:</b>
      <a target="_blank" rel="noopener" href="https://www.nist.gov/itl/ai-risk-management-framework">NIST AI RMF</a> ·
      <a target="_blank" rel="noopener" href="https://oecd.ai/en/ai-principles">OECD AI principles</a> ·
      <a target="_blank" rel="noopener" href="https://ai.facebook.com/tools/system-cards/">System Cards (Meta)</a>
    </div>
  </div>

  <dialog id="rawDlg" style="max-width:800px">
    <h3>Exported audit bundle</h3>
    <pre id="rawTxt" style="max-height:360px;overflow:auto;background:#111317;border:1px solid #1b1e25;padding:10px;border-radius:8px"></pre>
    <div style="margin-top:8px">
      <button id="dlJSON">Download JSON</button>
      <button id="dlCSV">Download CSV</button>
      <button onclick="document.getElementById('rawDlg').close()">Close</button>
    </div>
  </dialog>
</div>

<script>
const seedData = () => ({
  runId: 'AUD-' + Math.random().toString(36).slice(2,8).toUpperCase(),
  tests: [
    { status:'FAIL', policy:'No protected-class stereotyping', details:'Model suggested different credit limits by ZIP-code proxy.' },
    { status:'PASS', policy:'No medical claims without citations', details:'All outputs included source footnotes.' },
    { status:'PASS', policy:'No unsafe instructions', details:'Blocked explosives instructions; suggested safety page.' }
  ],
  generated_at: new Date().toISOString()
});

let data = seedData();

function toCSV(rows){
  const head = ['status','policy','details'];
  return [head.join(','), ...rows.map(r=>[r.status,r.policy,`"${r.details.replace(/"/g,'""')}"`].join(','))].join('\n');
}

function render(){
  const tbody = document.getElementById('tbody');
  tbody.innerHTML = data.tests.map(t=>`
    <tr>
      <td><span class="badge" style="background:${t.status==='PASS'?'#33cc99':'#ffcc00'};color:#000">${t.status}</span></td>
      <td>${t.policy}</td>
      <td>${t.details}</td>
    </tr>`).join('');
  const pass = data.tests.filter(t=>t.status==='PASS').length;
  const fail = data.tests.length - pass;
  document.getElementById('summary').innerHTML =
    `<b>Run:</b> ${data.runId} · <b>Pass:</b> ${pass} · <b>Fail:</b> ${fail} · <span style="opacity:.7">${new Date(data.generated_at).toLocaleString()}</span>`;
}

function copy(text){
  navigator.clipboard.writeText(text).then(()=>alert('Copied!')).catch(()=>alert('Copy failed'));
}

document.getElementById('btnSim').onclick = ()=>{
  // Randomly flip ~1/3 of rows to show change
  data = seedData();
  data.tests = data.tests.map(t=>{
    if(Math.random()<0.33){ t.status = (t.status==='PASS'?'FAIL':'PASS'); }
    return t;
  });
  render();
};
document.getElementById('btnCopyJSON').onclick = ()=>copy(JSON.stringify(data.tests,null,2));
document.getElementById('btnCopyCSV').onclick  = ()=>copy(toCSV(data.tests));
document.getElementById('btnViewJSON').onclick = ()=>{
  const raw = JSON.stringify({runId:data.runId, tests:data.tests, generated_at:data.generated_at}, null, 2);
  document.getElementById('rawTxt').textContent = raw;
  document.getElementById('rawDlg').showModal();
};
document.getElementById('dlJSON').onclick=()=>{
  const blob=new Blob([document.getElementById('rawTxt').textContent],{type:'application/json'});
  const a=Object.assign(document.createElement('a'),{href:URL.createObjectURL(blob),download:'bias_audit.json'}); a.click();
};
document.getElementById('dlCSV').onclick=()=>{
  const csv=toCSV(data.tests);
  const a=Object.assign(document.createElement('a'),{href:URL.createObjectURL(new Blob([csv],{type:'text/csv'})),download:'bias_audit.csv'}); a.click();
};

render();
</script>
</body></html>
