<!doctype html>
<html>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Constitutional Bias Dashboard — ETHRAEON</title>
<link rel="stylesheet" href="/assets/brand.css">
<body>
  <div class="container">
    <div class="hero">
      <div class="logo"></div>
      <div>
        <h1>Constitutional Bias Dashboard</h1>
        <div class="small">Monitor outputs vs. policies; spot failures; export audits.</div>
      </div>
    </div>

    <div class="card">
      <div class="badge">SIMULATED</div>
      <h2>What this tells you</h2>
      <p class="small" style="margin:6px 0">
        Each row is a policy check with PASS/FAIL and a short rationale. Use “Copy JSON” for tickets or
        “Export CSV” for stakeholder review. “If FAIL…” gives you a next step.
      </p>

      <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 4px">
        <button id="copyJsonBtn">Copy JSON</button>
        <button id="exportCsvBtn">Export CSV</button>
        <a id="viewRawJson" class="small" href="#" style="align-self:center">View raw JSON</a>
      </div>

      <div id="tableWrap" style="margin-top:10px;overflow:auto">
        <!-- table renders here -->
      </div>

      <div class="card" style="margin-top:12px">
        <strong>If FAIL…</strong>
        <ul class="small" style="margin:6px 0">
          <li><b>Identify</b> which prompt/output violated policy.</li>
          <li><b>Mitigate</b> (prompt rule, guardrail, or model filter).</li>
          <li><b>Re-test</b> and attach this dashboard’s export to the audit ticket.</li>
        </ul>
      </div>

      <p class="small" style="margin-top:10px">Status: Interactive demo with simulated data.</p>
    </div>
  </div>

  <script src="/assets/demo.js"></script>
<script>
function toCSV(rows){
  const head = ["status","policy","details"];
  const esc = v => `"${String(v).replace(/"/g,'""')}"`;
  return [head.join(","), ...rows.map(t=>[t.pass?'PASS':'FAIL', t.policy, t.details].map(esc).join(","))].join("\n");
}
function copy(txt){ navigator.clipboard.writeText(txt).then(()=>alert('Copied.')); }

loadJSON('/data/bias.json').then(d=>{
  const pass = d.tests.filter(t=>t.pass).length;
  const total = d.tests.length;
  const summary = `Policies met: ${pass}/${total} • ${Math.round(pass/total*100)}% compliance`;
  document.querySelector('#bias').innerHTML = `
    <div class="card">
      <b>Summary:</b> ${summary}<br>
      <div style="margin-top:8px">
        <button id="btnCopyJSON">Copy JSON</button>
        <button id="btnCopyCSV">Copy CSV</button>
      </div>
    </div>
    <div style="margin-top:8px"></div>
    ${d.tests.map(t=>`
      <div class="card" style="margin:8px 0">
        <b>Status:</b> ${t.pass?'PASS':'FAIL'} &nbsp; <b>Policy:</b> ${t.policy}<br>
        <b>Details:</b> ${t.details}
      </div>`).join('')}
  `;
  document.querySelector('#btnCopyJSON').onclick = ()=>copy(JSON.stringify(d.tests, null, 2));
  document.querySelector('#btnCopyCSV').onclick  = ()=>copy(toCSV(d.tests));
});
</script>
</body>
</html>
